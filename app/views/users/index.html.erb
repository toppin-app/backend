<style>
  /* Cursores pointer para elementos interactivos - Con !important para forzar el estilo */
  .form-check-label:hover, 
  .form-check-input:hover, 
  .form-check:hover,
  .btn:hover, 
  a:hover, 
  select.form-select:hover, 
  input[type="date"]:hover {
    cursor: pointer !important;
  }
  
  /* Hover para los labels de los checkboxes */
  .form-check-label:hover {
    color: #667eea !important;
    font-weight: 500;
    transform: scale(1.02);
  }
  
  /* Hover para los checkboxes (switches) */
  .form-check-input:hover {
    cursor: pointer !important;
    border-color: #667eea !important;
    box-shadow: 0 0 8px rgba(102, 126, 234, 0.4) !important;
  }
  
  /* Hover para inputs de fecha */
  input[type="date"] {
    cursor: pointer !important;
    border-width: 2px;
    border-radius: 6px;
    padding: 8px 12px;
  }
  
  input[type="date"]:hover {
    cursor: pointer !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.2) !important;
    transform: translateY(-1px);
  }
  
  input[type="date"]:focus {
    cursor: pointer !important;
    border-color: #667eea !important;
    box-shadow: 0 0 0 0.25rem rgba(102, 126, 234, 0.25) !important;
  }
  
  /* Estilos mejorados para selects */
  select.form-select {
    cursor: pointer !important;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    padding: 10px 40px 10px 12px;
    font-size: 15px;
    font-weight: 500;
    background-color: #ffffff;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23667eea' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 12px;
    transition: all 0.3s ease;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
  }
  
  select.form-select:hover {
    cursor: pointer !important;
    border-color: #667eea !important;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.25) !important;
    transform: translateY(-2px);
    background-color: #f8f9ff;
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%235568d3' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  }
  
  select.form-select:focus {
    cursor: pointer !important;
    border-color: #764ba2 !important;
    box-shadow: 0 0 0 0.3rem rgba(118, 75, 162, 0.3) !important;
    background-color: #fff;
    outline: none;
  }
  
  /* Hover para bot√≥n de ordenar */
  .sort_link.btn {
    color: white !important;
    border: 1px solid #667eea;
    font-weight: 500;
    transition: all 0.3s ease;
    cursor: pointer !important;
    padding: 6px 12px;
    font-size: 13px;
  }
  
  .sort_link.btn-outline-secondary {
    color: #495057 !important;
    background-color: white;
    border-color: #ced4da;
  }
  
  .sort_link.btn-outline-secondary:hover {
    cursor: pointer !important;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    border-color: #667eea !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(102, 126, 234, 0.3);
  }
  
  /* Bot√≥n de ordenamiento activo */
  .sort_link.btn-outline-secondary.asc,
  .sort_link.btn-outline-secondary.desc {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
    color: white !important;
    border-color: #667eea !important;
  }
  
  .sort_link.btn:active {
    transform: translateY(0px);
    box-shadow: 0 2px 4px rgba(102, 126, 234, 0.3);
  }
  
  /* Hover para bot√≥n de limpiar filtros */
  .btn-outline-danger {
    cursor: pointer !important;
  }
  
  .btn-outline-danger:hover {
    cursor: pointer !important;
    background-color: #dc3545 !important;
    color: white !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 10px rgba(220, 53, 69, 0.4);
  }
  
  /* Hover para botones generales */
  .btn {
    cursor: pointer !important;
  }
  
  .btn:hover {
    cursor: pointer !important;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
  
  /* Transiciones suaves para todos los elementos */
  .form-check-label,
  .form-check-input,
  .btn,
  input[type="date"],
  select.form-select {
    transition: all 0.3s ease;
  }
  
  /* RESPONSIVE - Mobile */
  @media (max-width: 768px) {
    /* Card header m√°s peque√±o en m√≥vil */
    .card-header h5 {
      font-size: 16px !important;
    }
    
    /* Reducir padding en card body */
    .card-body {
      padding: 15px !important;
    }
    
    /* Ajustar margin de rows */
    .row.mb-3 {
      margin-bottom: 20px !important;
    }
    
    /* Labels m√°s peque√±os */
    .form-label {
      font-size: 13px !important;
      margin-bottom: 6px !important;
    }
    
    /* Inputs y selects con mejor tama√±o para m√≥vil */
    .form-control,
    select.form-select,
    input[type="date"] {
      font-size: 14px !important;
      padding: 10px !important;
    }
    
    /* Botones m√°s peque√±os en m√≥vil */
    .btn {
      font-size: 13px !important;
      padding: 8px 12px !important;
    }
    
    .btn i {
      font-size: 12px !important;
    }
    
    /* Input group search m√°s compacto */
    .input-group .form-control {
      font-size: 14px !important;
    }
    
    /* Checkboxes en columna en m√≥vil */
    .d-flex.flex-wrap {
      flex-direction: column !important;
      gap: 15px !important;
    }
    
    .form-check {
      width: 100% !important;
    }
    
    /* Bot√≥n de limpiar centrado en m√≥vil */
    .text-end {
      text-align: center !important;
    }
    
    .btn-outline-danger {
      width: 100% !important;
    }
    
    /* Bot√≥n de ordenar con ancho completo */
    .sort_link.btn {
      width: 100% !important;
      margin-top: 5px;
    }
    
    /* Reducir efectos de elevaci√≥n en m√≥vil (t√°ctil) */
    .btn:hover,
    select.form-select:hover,
    input[type="date"]:hover {
      transform: none !important;
    }
    
    /* TODAS las columnas ocupan 100% del ancho en m√≥vil */
    .col-md-6,
    .col-md-12,
    .col-6,
    .col-12 {
      width: 100% !important;
      max-width: 100% !important;
      flex: 0 0 100% !important;
      padding-left: 15px !important;
      padding-right: 15px !important;
      margin-bottom: 15px !important;
    }
    
    /* Rows sin padding negativo */
    .row {
      margin-left: 0 !important;
      margin-right: 0 !important;
    }
    
    /* Espaciado del card */
    .card.shadow-sm {
      margin-bottom: 15px !important;
    }
    
    /* Bot√≥n de nuevo usuario con ancho completo */
    div[style*="margin-bottom: 20px"] .btn {
      width: 100% !important;
    }
    
    /* Input group con bot√≥n debajo en m√≥vil */
    .input-group {
      flex-direction: column !important;
    }
    
    .input-group .form-control {
      width: 100% !important;
      margin-bottom: 10px !important;
      border-radius: 6px !important;
    }
    
    .input-group .btn {
      width: 100% !important;
      border-radius: 6px !important;
    }
  }
  
  /* Tablet - Ajustes intermedios */
  @media (min-width: 769px) and (max-width: 992px) {
    .form-label {
      font-size: 14px !important;
    }
    
    .form-control,
    select.form-select {
      font-size: 14px !important;
    }
    
    .btn {
      font-size: 14px !important;
    }
  }
</style>

<div style="margin-bottom: 20px;">
  <%= button_to new_user_path, method: 'get', class: 'btn btn-success' do %>
    <i class="fa fa-plus"></i> Nuevo usuario
  <% end %>
</div>

<div class="card shadow-sm">
  <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <h5 class="mb-0"><i class="fa fa-filter"></i> Filtros de b√∫squeda</h5>
  </div>
  <div class="card-body">

  <%= search_form_for @q, url: users_path do |f| %>

  <!-- B√∫squeda principal -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-search"></i> <strong>Buscar usuario</strong></label>
      <div class="input-group">
        <%= f.search_field :email_or_name_cont, value: @search, class: 'form-control', placeholder: "Email o nombre del usuario" %>
        <button type="submit" class="btn btn-primary">
          <i class="fa fa-search"></i> Buscar
        </button>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-calendar"></i> <strong>Fecha de registro en la app</strong></label>
      <div class="row">
        <div class="col-6">
          <label class="form-label" style="font-size: 12px; margin-bottom: 5px;">Desde</label>
          <%= f.date_field :created_at_gteq, class: 'form-control' %>
        </div>
        <div class="col-6">
          <label class="form-label" style="font-size: 12px; margin-bottom: 5px;">Hasta</label>
          <%= f.date_field :created_at_lteq, class: 'form-control' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros de ubicaci√≥n -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-map-marker-alt"></i> <strong>Ubicaci√≥n</strong></label>
      <div class="row">
        <div class="col-6">
          <%= f.select :location_country_eq, 
              options_for_select([['Todos los pa√≠ses', '']] + @countries.map { |c| [c, c] }, params.dig(:q, :location_country_eq)), 
              {}, 
              { class: 'form-select', onchange: 'this.form.submit();' } %>
        </div>
        <div class="col-6">
          <%= f.select :location_city_eq, 
              options_for_select([['Todas las ciudades', '']] + @cities.map { |c| [c, c] }, params.dig(:q, :location_city_eq)), 
              {}, 
              { class: 'form-select', onchange: 'this.form.submit();' } %>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-sort"></i> <strong>Ordenar por</strong></label>
      <div class="d-flex flex-wrap" style="gap: 8px;">
        <%= sort_link(@q, :created_at, '<i class="fa fa-calendar"></i> Fecha de registro'.html_safe, class: 'btn btn-outline-secondary btn-sm') %>
        <%= sort_link(@q, :name, '<i class="fa fa-font"></i> Nombre'.html_safe, class: 'btn btn-outline-secondary btn-sm') %>
        <%= sort_link(@q, :email, '<i class="fa fa-envelope"></i> Email'.html_safe, class: 'btn btn-outline-secondary btn-sm') %>
        <%= sort_link(@q, :ranking, '<i class="fa fa-trophy"></i> Ranking'.html_safe, class: 'btn btn-outline-secondary btn-sm') %>
      </div>
    </div>
  </div>

  <!-- Filtros de tipo de usuario -->
  <div class="row mb-3">
    <div class="col-md-12">
      <label class="form-label"><i class="fa fa-filter"></i> <strong>Filtros adicionales</strong></label>
      <div class="d-flex flex-wrap align-items-center" style="gap: 20px;">
        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :include_deleted, '1', @include_deleted, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'include_deleted_checkbox' %>
          <%= label_tag :include_deleted, 'üóëÔ∏è Incluir eliminados', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>

        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :show_real_users, '1', @show_real_users, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'show_real_users_checkbox' %>
          <%= label_tag :show_real_users, 'üë§ Usuarios reales', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>

        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :show_fake_users, '1', @show_fake_users, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'show_fake_users_checkbox' %>
          <%= label_tag :show_fake_users, 'ü§ñ Usuarios fake', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>

        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :show_blocked_users, '1', @show_blocked_users, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'show_blocked_users_checkbox' %>
          <%= label_tag :show_blocked_users, 'üö´ Solo bloqueados', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√≥n limpiar filtros -->
  <div class="row mb-3">
    <div class="col-md-12 text-end">
      <%= link_to users_path, method: 'get', class: 'btn btn-outline-danger' do %>
        <i class="fa fa-times"></i> Limpiar todos los filtros
      <% end %>
    </div>
  </div>


  </div>

  <%end%>
 </div>
</div>


<hr>

<div class="card card-body table-responsive">
<table class="table table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ID</th>
      <th>Nombre</th>
      <th>Email</th>
      <th>Ubicaci√≥n</th>
      <th>G√©nero / Edad</th>
      <th>Likes</th>
      <th>Ranking</th>
      <th>Matches</th>
      <th>Registrado</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
    <tr <%= 'style=background-color:#ffe6e6;'.html_safe if user.deleted_account %>>
      <td>
        <% if user.user_media.any? %>
           <%= image_tag user.user_media.first.file.thumb.url, style: 'height: 50px;' if user.user_media.first.file.url and !user.bundled %>
           <%= image_tag user.user_media.first.file.thumb.url, style: 'height: 50px; border: 3px dotted purple' if user.user_media.first.file.url and user.bundled %>
        <% end %>
        </td>
      <td>
        <% if user.admin? %>
          <i class="fa fa-check"></i>
        <% end %>
        <% if user.deleted_account %>
          <i class="fa fa-trash text-danger" title="Usuario eliminado"></i>
        <% end %>
        <% if user.fake_user %>
          <i class="fa fa-robot text-info" style="font-size: 1.5em;" title="Usuario fake/bot"></i>
        <% end %>
        <% if user.blocked %>
          <i class="fa fa-ban text-danger" style="font-size: 1.2em;" title="Usuario bloqueado"></i>
        <% end %>
        <%= user.id %></td>
      <td> 
        <%= link_to user.name, show_user_path(id: user.id) %>
        <% if user.current_subscription_name == 'supreme' %>
          <span class="badge badge-warning" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; font-weight: bold;">
            <i class="fa fa-crown"></i> SUPREME
          </span>
        <% elsif user.current_subscription_name == 'premium' %>
          <span class="badge badge-info" style="background: linear-gradient(135deg, #667eea, #764ba2); color: #fff;">
            <i class="fa fa-star"></i> PREMIUM
          </span>
        <% else %>
          <span class="badge badge-secondary" style="background-color: #6c757d; color: #fff;">
            <i class="fa fa-user"></i> GRATIS
          </span>
        <% end %>
      </td>
      <td><%= user.email %></td>
      <td>
        <% if user.location_country.present? || user.location_city.present? %>
          <i class="fa fa-map-marker-alt text-primary"></i>
          <strong><%= user.location_country %></strong>
          <% if user.location_city.present? %>
            <br><small class="text-muted"><%= user.location_city %></small>
          <% end %>
        <% elsif user.living_in.present? %>
          <%= user.living_in %>
        <% else %>
          <span class="text-muted"><i>Sin ubicaci√≥n</i></span>
        <% end %>
      </td>
      <td>
        <%= user.gender_t %><br>
        <%= user.user_age %> a√±os</td>
      <td><%= user.incoming_likes.count %></td>
      <td><%= user.ranking %></td>

      <td><%= user.matches.count %></td>

      <td><%= user.created_at.strftime("%d-%m-%Y %H:%M") %>
        <br>
          <small><%= user.social %></small>
      </td>
      <td><%= link_to 'Gestionar', show_user_path(id: user.id), :"data-turbolinks" => false  %></td>
      <td><%= link_to 'Editar', edit_user_path(id: user.id), :"data-turbolinks" => false  %></td>
      <td>
        <%= link_to 'Eliminar', destroy_user_path(id: user.id), method: :delete, data: { confirm: '¬øEliminar el usuario seleccionado?' } %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>

<!-- Selector de usuarios por p√°gina -->
<div class="d-flex align-items-center" style="gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #dee2e6;">
  <label class="mb-0" style="font-weight: 500;"><i class="fa fa-list"></i> Mostrar:</label>
  <%= form_tag users_path, method: :get, id: 'per_page_form', style: 'display: inline-flex; align-items: center; gap: 8px;' do %>
    <%# Preservar par√°metros de b√∫squeda solo si es un Hash %>
    <% if params[:q].present? && params[:q].is_a?(Hash) %>
      <% params[:q].each do |key, value| %>
        <%= hidden_field_tag "q[#{key}]", value %>
      <% end %>
    <% end %>
    <%= hidden_field_tag :include_deleted, params[:include_deleted] if params[:include_deleted] %>
    <%= hidden_field_tag :show_real_users, params[:show_real_users] if params[:show_real_users] %>
    <%= hidden_field_tag :show_fake_users, params[:show_fake_users] if params[:show_fake_users] %>
    
    <%= select_tag :per_page,
        options_for_select([["15", 15], ["25", 25], ["50", 50], ["100", 100], ["Personalizado", "custom"]], params[:per_page] == 'custom' ? 'custom' : (params[:per_page] || 15)),
        class: 'form-select',
        style: 'width: auto; min-width: 120px;',
        id: 'per_page_select',
        onchange: 'handlePerPageChange(this.value);' %>
    
    <%= number_field_tag :custom_per_page,
        params[:custom_per_page],
        class: 'form-control',
        placeholder: 'Cantidad',
        min: 1,
        max: 500,
        style: "width: 100px; #{params[:per_page] == 'custom' ? '' : 'display: none;'}",
        id: 'custom_per_page_input' %>
    
    <button type="submit" class="btn btn-primary btn-sm" style="#{params[:per_page] == 'custom' ? '' : 'display: none;'}" id="apply_custom_btn">
      <i class="fa fa-check"></i> Aplicar
    </button>
  <% end %>
  <span class="text-muted" style="font-size: 14px;">usuarios por p√°gina</span>
</div>

<!-- Paginaci√≥n -->
<div class="digg_pagination" style="margin-top: 15px; padding-bottom: 10px;">
  <%= will_paginate @users, :container => false %>
</div>

</div>

<script>
function handlePerPageChange(value) {
  const customInput = document.getElementById('custom_per_page_input');
  const applyBtn = document.getElementById('apply_custom_btn');
  const form = document.getElementById('per_page_form');
  
  if (value === 'custom') {
    customInput.style.display = 'block';
    applyBtn.style.display = 'block';
    customInput.focus();
  } else {
    customInput.style.display = 'none';
    applyBtn.style.display = 'none';
    form.submit();
  }
}
</script>
