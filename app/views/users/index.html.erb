
<div style="margin-bottom: 20px;">
  <%= button_to new_user_path, method: 'get', class: 'btn btn-success' do %>
    <i class="fa fa-plus"></i> Nuevo usuario
  <% end %>
</div>

<div class="card shadow-sm">
  <div class="card-header" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
    <h5 class="mb-0"><i class="fa fa-filter"></i> Filtros de b√∫squeda</h5>
  </div>
  <div class="card-body">

  <%= search_form_for @q, url: users_path do |f| %>

  <!-- B√∫squeda principal -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-search"></i> <strong>Buscar usuario</strong></label>
      <div class="input-group">
        <%= f.search_field :email_or_name_cont, value: @search, class: 'form-control', placeholder: "Email o nombre del usuario" %>
        <button type="submit" class="btn btn-primary">
          <i class="fa fa-search"></i> Buscar
        </button>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-calendar"></i> <strong>Fecha de registro en la app</strong></label>
      <div class="row">
        <div class="col-6">
          <label class="form-label" style="font-size: 12px; margin-bottom: 5px;">Desde</label>
          <%= f.date_field :created_at_gteq, class: 'form-control' %>
        </div>
        <div class="col-6">
          <label class="form-label" style="font-size: 12px; margin-bottom: 5px;">Hasta</label>
          <%= f.date_field :created_at_lteq, class: 'form-control' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros de ubicaci√≥n -->
  <div class="row mb-3">
    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-map-marker-alt"></i> <strong>Ubicaci√≥n</strong></label>
      <div class="row">
        <div class="col-6">
          <%= f.select :location_country_eq, 
              options_for_select([['Todos los pa√≠ses', '']] + @countries.map { |c| [c, c] }, params.dig(:q, :location_country_eq)), 
              {}, 
              { class: 'form-select', onchange: 'this.form.submit();' } %>
        </div>
        <div class="col-6">
          <%= f.select :location_city_eq, 
              options_for_select([['Todas las ciudades', '']] + @cities.map { |c| [c, c] }, params.dig(:q, :location_city_eq)), 
              {}, 
              { class: 'form-select', onchange: 'this.form.submit();' } %>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <label class="form-label"><i class="fa fa-sort"></i> <strong>Ordenar por</strong></label>
      <div>
        <%= sort_link(@q, :created_at, '<i class="fa fa-calendar"></i> Fecha de registro'.html_safe, class: 'btn btn-outline-secondary btn-sm') %>
      </div>
    </div>
  </div>

  <!-- Filtros de tipo de usuario -->
  <div class="row mb-3">
    <div class="col-md-12">
      <label class="form-label"><i class="fa fa-filter"></i> <strong>Filtros adicionales</strong></label>
      <div class="d-flex flex-wrap align-items-center" style="gap: 20px;">
        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :include_deleted, '1', @include_deleted, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'include_deleted_checkbox' %>
          <%= label_tag :include_deleted, 'üóëÔ∏è Incluir eliminados', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>

        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :show_real_users, '1', @show_real_users, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'show_real_users_checkbox' %>
          <%= label_tag :show_real_users, 'üë§ Usuarios reales', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>

        <div class="form-check form-switch d-flex align-items-center" style="margin: 0;">
          <%= check_box_tag :show_fake_users, '1', @show_fake_users, 
              onclick: "this.form.submit();", 
              class: 'form-check-input',
              style: 'margin-top: 0;',
              id: 'show_fake_users_checkbox' %>
          <%= label_tag :show_fake_users, 'ü§ñ Usuarios fake', class: 'form-check-label', style: 'margin-left: 8px; margin-bottom: 0;' %>
        </div>
      </div>
    </div>
  </div>

  <!-- Bot√≥n limpiar filtros -->
  <div class="row mb-3">
    <div class="col-md-12 text-end">
      <%= link_to users_path, method: 'get', class: 'btn btn-outline-danger' do %>
        <i class="fa fa-times"></i> Limpiar todos los filtros
      <% end %>
    </div>
  </div>


  </div>

  <%end%>
 </div>
</div>


<hr>

<div class="card card-body table-responsive">
<table class="table table-striped">
  <thead>
    <tr>
      <th></th>
      <th>ID</th>
      <th>Nombre</th>
      <th>Email</th>
      <th>Ubicaci√≥n</th>
      <th>G√©nero / Edad</th>
      <th>Likes</th>
      <th>Ranking</th>
      <th>Matches</th>
      <th>Registrado</th>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @users.each do |user| %>
    <tr <%= 'style=background-color:#ffe6e6;'.html_safe if user.deleted_account %>>
      <td>
        <% if user.user_media.any? %>
           <%= image_tag user.user_media.first.file.thumb.url, style: 'height: 50px;' if user.user_media.first.file.url and !user.bundled %>
           <%= image_tag user.user_media.first.file.thumb.url, style: 'height: 50px; border: 3px dotted purple' if user.user_media.first.file.url and user.bundled %>
        <% end %>
        </td>
      <td>
        <% if user.admin? %>
          <i class="fa fa-check"></i>
        <% end %>
        <% if user.deleted_account %>
          <i class="fa fa-trash text-danger" title="Usuario eliminado"></i>
        <% end %>
        <% if user.fake_user %>
          <i class="fa fa-robot text-info" style="font-size: 1.5em;" title="Usuario fake/bot"></i>
        <% end %>
        <%= user.id %></td>
      <td> 
        <%= link_to user.name, show_user_path(id: user.id) %>
        <% if user.current_subscription_name == 'supreme' %>
          <span class="badge badge-warning" style="background: linear-gradient(135deg, #FFD700, #FFA500); color: #000; font-weight: bold;">
            <i class="fa fa-crown"></i> SUPREME
          </span>
        <% elsif user.current_subscription_name == 'premium' %>
          <span class="badge badge-info" style="background: linear-gradient(135deg, #667eea, #764ba2); color: #fff;">
            <i class="fa fa-star"></i> PREMIUM
          </span>
        <% else %>
          <span class="badge badge-secondary" style="background-color: #6c757d; color: #fff;">
            <i class="fa fa-user"></i> GRATIS
          </span>
        <% end %>
      </td>
      <td><%= user.email %></td>
      <td>
        <% if user.location_country.present? || user.location_city.present? %>
          <i class="fa fa-map-marker-alt text-primary"></i>
          <strong><%= user.location_country %></strong>
          <% if user.location_city.present? %>
            <br><small class="text-muted"><%= user.location_city %></small>
          <% end %>
        <% elsif user.living_in.present? %>
          <%= user.living_in %>
        <% else %>
          <span class="text-muted"><i>Sin ubicaci√≥n</i></span>
        <% end %>
      </td>
      <td>
        <%= user.gender_t %><br>
        <%= user.user_age %> a√±os</td>
      <td><%= user.incoming_likes.count %></td>
      <td><%= user.ranking %></td>

      <td><%= user.matches.count %></td>

      <td><%= user.created_at.strftime("%d-%m-%Y %H:%M") %>
        <br>
          <small><%= user.social %></small>
      </td>
      <td><%= link_to 'Gestionar', show_user_path(id: user.id), :"data-turbolinks" => false  %></td>
      <td><%= link_to 'Editar', edit_user_path(id: user.id), :"data-turbolinks" => false  %></td>
      <td>
        <%= link_to 'Eliminar', destroy_user_path(id: user.id), method: :delete, data: { confirm: '¬øEliminar el usuario seleccionado?' } %>
      </td>
    </tr>
    <% end %>
  </tbody>
</table>
</div>

<div class="digg_pagination">
  <%= will_paginate @users, :container => false %>
</div>
