<% if @blocked_by_users.any? %>
  <div class="table-responsive">
    <table class="table table-sm table-hover">
      <thead class="thead-light">
        <tr>
          <th>ID</th>
          <th>Usuario</th>
          <th>Email</th>
          <th>Bloqueado el</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <% @blocked_by_users.each do |block| %>
          <tr>
            <td><%= block.user_id %></td>
            <td>
              <% if block.user.present? %>
                <%= link_to block.user.user_name, user_path(block.user), class: 'text-primary' %>
              <% else %>
                <span class="text-muted">Usuario eliminado</span>
              <% end %>
            </td>
            <td>
              <% if block.user.present? %>
                <%= block.user.email %>
              <% else %>
                -
              <% end %>
            </td>
            <td><%= block.created_at.strftime("%d/%m/%Y %H:%M") %></td>
            <td>
              <% if block.user.present? %>
                <%= link_to 'Ver perfil', user_path(block.user), class: 'btn btn-sm btn-info text-white', target: '_blank' %>
              <% end %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  
  <%= will_paginate @blocked_by_users, param_name: 'blocked_by_users_page', params: { anchor: 'blocked-by-users-container' }, 
      renderer: BootstrapPagination::Rails, 
      inner_window: 2, 
      outer_window: 0,
      previous_label: '←',
      next_label: '→' %>
  
  <script>
    // AJAX para paginación de bloqueado por
    document.addEventListener('DOMContentLoaded', function() {
      const blockedByContainer = document.getElementById('blocked-by-users-container');
      if (blockedByContainer) {
        blockedByContainer.addEventListener('click', function(e) {
          if (e.target.closest('.pagination a')) {
            e.preventDefault();
            const link = e.target.closest('a');
            fetch(link.href, {
              headers: {
                'X-Requested-With': 'XMLHttpRequest'
              }
            })
            .then(response => response.text())
            .then(html => {
              const parser = new DOMParser();
              const doc = parser.parseFromString(html, 'text/html');
              const newContent = doc.getElementById('blocked-by-users-container');
              if (newContent) {
                blockedByContainer.innerHTML = newContent.innerHTML;
              }
            });
          }
        });
      }
    });
  </script>
<% else %>
  <p class="text-muted">Ningún usuario lo ha bloqueado.</p>
<% end %>
