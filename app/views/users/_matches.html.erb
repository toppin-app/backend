<table class="table">
  <thead>
    <th></th>
    <th>Usuario</th>
    <th>Es superlike</th>
    <th>Ranking</th>
    <th>Fecha match</th>
    <th> </th>
  </thead>

  <% @matches.each do |match_request| %>
  <tr>
    <td>
      <% if match_request.target && match_request.target.id != @user.id && match_request.target.profile_picture_thumb.present? %>
      <%= image_tag match_request.target.profile_picture_thumb, class: 'img-thumbnail', style: 'height: 70px;' %>
      <% end %>

      <% if match_request.user && match_request.user.id != @user.id && match_request.user.profile_picture_thumb.present? %>
      <%= image_tag match_request.user.profile_picture_thumb, class: 'img-thumbnail', style: 'height: 70px;' %>
      <% end %>
    </td>
    <td>
      <%= link_to match_request.target.name, show_user_path(id: match_request.target.id) if match_request.target and match_request.target.id != @user.id %>
      <%= link_to match_request.user.name, show_user_path(id: match_request.user.id) if match_request.user and match_request.user.id != @user.id %>
    </td>
    <td><%= true_false(match_request.is_superlike) %></td>
    <td><%= match_request.target_user_ranking %></td>
    <td><%= match_request.created_at.strftime("%d-%m-%Y a las %H:%M") %></td>
    <td>
      <button class="btn btn-sm btn-primary chat disabled"
        id="<%= match_request.twilio_conversation_sid %>"
        data-sid="<%= match_request.twilio_conversation_sid %>">
        <i class="fas fa-comments"></i>
        Ver Chat
      </button>
      
      <% 
        # Determinar el target_user_id correcto
        other_user_id = match_request.target.id != @user.id ? match_request.target.id : match_request.user.id
      %>
      
      <%= link_to unmatch_path(user_id: @user.id, target_user: other_user_id), 
          method: :post,
          data: { confirm: '¿Estás seguro de que quieres deshacer este match? Se eliminará la conversación de Twilio.' },
          class: 'btn btn-sm btn-danger' do %>
        <i class="fas fa-times"></i> Deshacer
      <% end %>
    </td>
  </tr>
  <% end %>
</table>

<div class="d-flex justify-content-center mt-4">
  <%= will_paginate @matches, param_name: 'matches_page', previous_label: '← Anterior', next_label: 'Siguiente →' %>
</div>
