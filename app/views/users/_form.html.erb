
<%= form_for :user, url: @route do |f| %>

	<% if @edit %>
	<div class="field" hidden>
	     <%= f.label "Email" %>
	    <%= f.text_field :id , value: @user.id%>
	  </div>
	<% end %>

  <div class="field">
     <%= f.label "Email" %>
    <%= f.email_field :email, autofocus: true, value: @user.email, autocomplete: "email", class: 'form-control' %>
  </div>

  <div class="field">
     <%= f.label "Nombre" %>
    <%= f.text_field :name, autofocus: true, value: @user.name, class: 'form-control' %>
  </div>


  <div class="field">
     <%= f.label "G√©nero" %>

     <%= f.select :gender, [['Hombre', "male"], ['Mujer', "female"],['Pareja', "couple"], ['Otros', "gender_any"]]%>



  </div>

  <div class="field">
     <%= f.label "Fecha nacimiento" %>
    <%= f.date_field :birthday, value: @user.birthday, class: 'form-control' %>
  </div>

  <div class="field">
     <%= f.label "Lugar nacimiento" %>
    <%= f.text_field :born_in, autofocus: true, value: @user.born_in, class: 'form-control' %>
  </div>


  <div class="field">
     <%= f.label "Vive en" %>
    <%= f.text_field :living_in, autofocus: true, value: @user.living_in, class: 'form-control' %>
  </div>

  <hr>

  <h5>üìç Geolocalizaci√≥n <small class="text-muted">(Para que aparezca en swipes)</small></h5>
  
  <div class="card card-body" style="margin-bottom: 20px;">
    <p><small><i>Establece la ubicaci√≥n GPS del usuario. Esto es necesario para que aparezca en los swipes de otros usuarios.</i></small></p>
    
    <div class="alert alert-info" style="padding: 10px; margin-bottom: 15px;">
      <strong>Ubicaciones r√°pidas:</strong> 
      <a href="#" onclick="setValenciaLocation(); return false;" class="badge badge-primary">Valencia</a>
      <a href="#" onclick="setMadridLocation(); return false;" class="badge badge-primary">Madrid</a>
      <a href="#" onclick="setBarcelonaLocation(); return false;" class="badge badge-primary">Barcelona</a>
      <a href="#" onclick="setSevillaLocation(); return false;" class="badge badge-primary">Sevilla</a>
      <a href="#" onclick="setBilbaoLocation(); return false;" class="badge badge-primary">Bilbao</a>
      <a href="#" onclick="setMalagaLocation(); return false;" class="badge badge-primary">M√°laga</a>
    </div>
    
    <div class="row">
      <div class="col-md-6">
        <div class="field">
          <label><strong>Latitud</strong></label>
          <%= f.text_field :lat, value: @user.lat, class: 'form-control', placeholder: 'Ej: 39.4699', id: 'user_lat' %>
          <small class="form-text text-muted">Puedes obtenerla en <a href="https://www.google.com/maps" target="_blank">Google Maps</a> haciendo clic derecho</small>
        </div>
      </div>
      <div class="col-md-6">
        <div class="field">
          <label><strong>Longitud</strong></label>
          <%= f.text_field :lng, value: @user.lng, class: 'form-control', placeholder: 'Ej: -0.3763', id: 'user_lng' %>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top: 15px;">
      <div class="col-md-6">
        <div class="field">
          <label><strong>Ciudad</strong></label>
          <%= f.text_field :location_city, value: @user.location_city, class: 'form-control', placeholder: 'Ej: Valencia', id: 'user_location_city' %>
        </div>
      </div>
      <div class="col-md-6">
        <div class="field">
          <label><strong>Pa√≠s</strong></label>
          <%= f.text_field :location_country, value: @user.location_country, class: 'form-control', placeholder: 'Ej: Espa√±a', id: 'user_location_country' %>
        </div>
      </div>
    </div>

    <% if @user.lat.present? && @user.lng.present? %>
      <div style="margin-top: 15px;">
        <strong>Vista previa del mapa:</strong>
        <iframe
          width="100%" 
          height="250" 
          style="border:0; border-radius: 5px; margin-top: 10px;"
          loading="lazy"
          allowfullscreen
          src="https://www.google.com/maps?q=<%= @user.lat %>,<%= @user.lng %>&hl=es&z=13&output=embed">
        </iframe>
      </div>
    <% end %>

    <script>
      function setLocation(lat, lng, city, country) {
        document.getElementById('user_lat').value = lat;
        document.getElementById('user_lng').value = lng;
        document.getElementById('user_location_city').value = city;
        document.getElementById('user_location_country').value = country;
      }
      
      function setValenciaLocation() {
        setLocation('39.4699', '-0.3763', 'Valencia', 'Espa√±a');
      }
      
      function setMadridLocation() {
        setLocation('40.4168', '-3.7038', 'Madrid', 'Espa√±a');
      }
      
      function setBarcelonaLocation() {
        setLocation('41.3851', '2.1734', 'Barcelona', 'Espa√±a');
      }
      
      function setSevillaLocation() {
        setLocation('37.3891', '-5.9845', 'Sevilla', 'Espa√±a');
      }
      
      function setBilbaoLocation() {
        setLocation('43.2630', '-2.9350', 'Bilbao', 'Espa√±a');
      }
      
      function setMalagaLocation() {
        setLocation('36.7213', '-4.4214', 'M√°laga', 'Espa√±a');
      }
    </script>
  </div>

  <hr>


  <div class="field">
     <%= f.label "Descripci√≥n" %>
    <%= f.text_area :description, autofocus: true, value: @user.description, rows: 4, class: 'form-control' %>
  </div>


 <div class="card card-body">
  <div class="field">
      <% if @edit %>
        <% if @images.any? %>
          <p>Click sobre la imagen para eliminar. </p>
        <% end %>
        <% @images.each do |i| %>

          <% begin %>
            <%= link_to i, method: :delete, data: { confirm: '¬øEliminar?' } do %>
              <% if i.file.present? %>
                <%= image_tag i.file.thumb.url, style: 'max-height: 80px;' %>
              <% else %>
                <i class="far fa-file-image fa-6x" style="color: #65a4e6;"></i>
              <% end %>
            <% end %>
          <% rescue => e %>
            <p>Error al acceder a la imagen: <%= e.message %></p>
          <% end %>

        <% end %>
      <% end %>
      <%= f.label "Im√°genes" %>
      <%= f.file_field :images, multiple: true %>
   </div>
</div>


    <% if @edit %>
     <div style="padding: 10px;">
      <% @user.user_info_item_values.each do |iv| %>
        <span class="badge badge-info" style="margin: 3px;"><%= iv.category_name %>: <%= iv.item_name %>

          -- <%= link_to 'Eliminar', iv, method: :delete, data: { confirm: '¬øEliminar?' } %>
        </span>
      <% end %>
    </div>
    <% end %>


   <div class="card card-body">
    <b>Perfil</b>

      <div class="field">
         <%= collection_select(nil,:info_item_values, InfoItemValue.where.not(id: @user.user_info_item_values.pluck(:info_item_value_id)), :id, :name_with_category, {}, {:multiple => true, class: 'form-control selectpicker', "data-live-search" => "true", style: "height: 300px;"}) %>
      </div>
   </div>



    <hr>

    <h5>üé¨ Pel√≠culas Favoritas</h5>

    <% if @edit && @user.tmdb_user_data.any? %>
      <div style="padding: 10px; margin-bottom: 10px; background-color: #f8f9fa; border-radius: 5px;">
        <strong>Pel√≠culas actuales:</strong><br>
        <% @user.tmdb_user_data.each do |movie| %>
          <div style="display: inline-block; margin: 5px;">
            <span class="badge badge-success" style="font-size: 14px; padding: 8px; display: block;">
              <%= movie.title %>
              <% if movie.poster_path.present? %>
                <br><img src="https://image.tmdb.org/t/p/w92<%= movie.poster_path %>" style="max-width: 60px; margin-top: 5px; border-radius: 3px;">
              <% end %>
            </span>
            <%= link_to 'üóëÔ∏è Eliminar', "/tmdb_user_data/#{movie.id}", method: :delete, data: { confirm: '¬øEliminar pel√≠cula?' }, class: 'btn btn-sm btn-danger', style: 'margin-top: 5px;' %>
          </div>
        <% end %>
      </div>
    <% end %>

    <div class="card card-body" style="margin-bottom: 20px;">
      <p><small><i>Busca pel√≠culas por t√≠tulo. Selecciona hasta 3 pel√≠culas.</i></small></p>
      
      <div id="movies-container">
        <% 3.times do |i| %>
          <div class="movie-search-item" style="margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 5px; position: relative;">
            <strong style="display: block; margin-bottom: 10px;">Pel√≠cula #<%= i + 1 %></strong>
            
            <input type="text" 
                   id="movie_search_<%= i %>" 
                   class="form-control movie-search-input" 
                   placeholder="Escribe el t√≠tulo de la pel√≠cula..."
                   autocomplete="off"
                   style="margin-bottom: 10px;">
            
            <div id="movie_results_<%= i %>" class="search-results" style="display: none; position: absolute; z-index: 1000; background: white; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; width: calc(100% - 30px);"></div>
            
            <div id="movie_selected_<%= i %>" class="selected-movie" style="display: none; padding: 10px; background: white; border: 1px solid #28a745; border-radius: 4px;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <img id="movie_poster_preview_<%= i %>" src="" style="max-width: 50px; border-radius: 3px;">
                <div style="flex: 1;">
                  <strong id="movie_title_display_<%= i %>"></strong>
                  <br><small id="movie_year_display_<%= i %>"></small>
                </div>
                <button type="button" onclick="clearMovie(<%= i %>)" class="btn btn-sm btn-danger">‚úï</button>
              </div>
            </div>
            
            <%= hidden_field_tag "movie_#{i}_tmdb_id", nil, id: "movie_#{i}_tmdb_id" %>
            <%= hidden_field_tag "movie_#{i}_title", nil, id: "movie_#{i}_title" %>
            <%= hidden_field_tag "movie_#{i}_poster_path", nil, id: "movie_#{i}_poster_path" %>
          </div>
        <% end %>
      </div>
    </div>

    <hr>

    <h5>üì∫ Series Favoritas</h5>

    <% if @edit && @user.tmdb_user_series_data.any? %>
      <div style="padding: 10px; margin-bottom: 10px; background-color: #f8f9fa; border-radius: 5px;">
        <strong>Series actuales:</strong><br>
        <% @user.tmdb_user_series_data.each do |series| %>
          <div style="display: inline-block; margin: 5px;">
            <span class="badge badge-info" style="font-size: 14px; padding: 8px; display: block;">
              <%= series.title %>
              <% if series.poster_path.present? %>
                <br><img src="https://image.tmdb.org/t/p/w92<%= series.poster_path %>" style="max-width: 60px; margin-top: 5px; border-radius: 3px;">
              <% end %>
            </span>
            <%= link_to 'üóëÔ∏è Eliminar', "/tmdb_user_series_data/#{series.id}", method: :delete, data: { confirm: '¬øEliminar serie?' }, class: 'btn btn-sm btn-danger', style: 'margin-top: 5px;' %>
          </div>
        <% end %>
      </div>
    <% end %>

    <div class="card card-body" style="margin-bottom: 20px;">
      <p><small><i>Busca series por t√≠tulo. Selecciona hasta 3 series.</i></small></p>
      
      <div id="series-container">
        <% 3.times do |i| %>
          <div class="series-search-item" style="margin-bottom: 20px; padding: 15px; background-color: #f9f9f9; border-radius: 5px; position: relative;">
            <strong style="display: block; margin-bottom: 10px;">Serie #<%= i + 1 %></strong>
            
            <input type="text" 
                   id="series_search_<%= i %>" 
                   class="form-control series-search-input" 
                   placeholder="Escribe el t√≠tulo de la serie..."
                   autocomplete="off"
                   style="margin-bottom: 10px;">
            
            <div id="series_results_<%= i %>" class="search-results" style="display: none; position: absolute; z-index: 1000; background: white; border: 1px solid #ddd; border-radius: 4px; max-height: 300px; overflow-y: auto; width: calc(100% - 30px);"></div>
            
            <div id="series_selected_<%= i %>" class="selected-series" style="display: none; padding: 10px; background: white; border: 1px solid #17a2b8; border-radius: 4px;">
              <div style="display: flex; align-items: center; gap: 10px;">
                <img id="series_poster_preview_<%= i %>" src="" style="max-width: 50px; border-radius: 3px;">
                <div style="flex: 1;">
                  <strong id="series_title_display_<%= i %>"></strong>
                  <br><small id="series_year_display_<%= i %>"></small>
                </div>
                <button type="button" onclick="clearSeries(<%= i %>)" class="btn btn-sm btn-danger">‚úï</button>
              </div>
            </div>
            
            <%= hidden_field_tag "series_#{i}_tmdb_id", nil, id: "series_#{i}_tmdb_id" %>
            <%= hidden_field_tag "series_#{i}_title", nil, id: "series_#{i}_title" %>
            <%= hidden_field_tag "series_#{i}_poster_path", nil, id: "series_#{i}_poster_path" %>
          </div>
        <% end %>
      </div>
    </div>

    <script>
      let movieSearchTimeout;
      let seriesSearchTimeout;

      // B√∫squeda de pel√≠culas
      document.querySelectorAll('.movie-search-input').forEach((input, index) => {
        input.addEventListener('input', function() {
          clearTimeout(movieSearchTimeout);
          const query = this.value.trim();
          const resultsDiv = document.getElementById(`movie_results_${index}`);
          
          if (query.length < 2) {
            resultsDiv.style.display = 'none';
            return;
          }
          
          movieSearchTimeout = setTimeout(() => {
            fetch(`/tmdb/search_movies?query=${encodeURIComponent(query)}`)
              .then(response => response.json())
              .then(data => {
                if (data.length === 0) {
                  resultsDiv.innerHTML = '<div style="padding: 10px;">No se encontraron pel√≠culas</div>';
                  resultsDiv.style.display = 'block';
                  return;
                }
                
                resultsDiv.innerHTML = data.map(movie => `
                  <div class="search-result-item" 
                       onclick="selectMovie(${index}, ${movie.id}, '${movie.title.replace(/'/g, "\\'")}', '${movie.poster_path || ''}', '${movie.release_date || ''}')"
                       style="padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px;">
                    ${movie.poster_path ? `<img src="https://image.tmdb.org/t/p/w92${movie.poster_path}" style="max-width: 40px; border-radius: 3px;">` : '<div style="width: 40px; height: 60px; background: #ddd; border-radius: 3px;"></div>'}
                    <div>
                      <strong>${movie.title}</strong>
                      <br><small>${movie.release_date ? movie.release_date.substring(0, 4) : 'N/A'}</small>
                    </div>
                  </div>
                `).join('');
                resultsDiv.style.display = 'block';
              })
              .catch(err => console.error('Error:', err));
          }, 500);
        });
      });

      // B√∫squeda de series
      document.querySelectorAll('.series-search-input').forEach((input, index) => {
        input.addEventListener('input', function() {
          clearTimeout(seriesSearchTimeout);
          const query = this.value.trim();
          const resultsDiv = document.getElementById(`series_results_${index}`);
          
          if (query.length < 2) {
            resultsDiv.style.display = 'none';
            return;
          }
          
          seriesSearchTimeout = setTimeout(() => {
            fetch(`/tmdb/search_series?query=${encodeURIComponent(query)}`)
              .then(response => response.json())
              .then(data => {
                if (data.length === 0) {
                  resultsDiv.innerHTML = '<div style="padding: 10px;">No se encontraron series</div>';
                  resultsDiv.style.display = 'block';
                  return;
                }
                
                resultsDiv.innerHTML = data.map(series => `
                  <div class="search-result-item" 
                       onclick="selectSeries(${index}, ${series.id}, '${series.title.replace(/'/g, "\\'")}', '${series.poster_path || ''}', '${series.first_air_date || ''}')"
                       style="padding: 10px; cursor: pointer; border-bottom: 1px solid #eee; display: flex; align-items: center; gap: 10px;">
                    ${series.poster_path ? `<img src="https://image.tmdb.org/t/p/w92${series.poster_path}" style="max-width: 40px; border-radius: 3px;">` : '<div style="width: 40px; height: 60px; background: #ddd; border-radius: 3px;"></div>'}
                    <div>
                      <strong>${series.title}</strong>
                      <br><small>${series.first_air_date ? series.first_air_date.substring(0, 4) : 'N/A'}</small>
                    </div>
                  </div>
                `).join('');
                resultsDiv.style.display = 'block';
              })
              .catch(err => console.error('Error:', err));
          }, 500);
        });
      });

      function selectMovie(index, id, title, posterPath, releaseDate) {
        document.getElementById(`movie_${index}_tmdb_id`).value = id;
        document.getElementById(`movie_${index}_title`).value = title;
        document.getElementById(`movie_${index}_poster_path`).value = posterPath;
        
        document.getElementById(`movie_title_display_${index}`).textContent = title;
        document.getElementById(`movie_year_display_${index}`).textContent = releaseDate ? releaseDate.substring(0, 4) : '';
        
        if (posterPath) {
          document.getElementById(`movie_poster_preview_${index}`).src = `https://image.tmdb.org/t/p/w92${posterPath}`;
          document.getElementById(`movie_poster_preview_${index}`).style.display = 'block';
        } else {
          document.getElementById(`movie_poster_preview_${index}`).style.display = 'none';
        }
        
        document.getElementById(`movie_search_${index}`).style.display = 'none';
        document.getElementById(`movie_results_${index}`).style.display = 'none';
        document.getElementById(`movie_selected_${index}`).style.display = 'block';
      }

      function selectSeries(index, id, title, posterPath, firstAirDate) {
        document.getElementById(`series_${index}_tmdb_id`).value = id;
        document.getElementById(`series_${index}_title`).value = title;
        document.getElementById(`series_${index}_poster_path`).value = posterPath;
        
        document.getElementById(`series_title_display_${index}`).textContent = title;
        document.getElementById(`series_year_display_${index}`).textContent = firstAirDate ? firstAirDate.substring(0, 4) : '';
        
        if (posterPath) {
          document.getElementById(`series_poster_preview_${index}`).src = `https://image.tmdb.org/t/p/w92${posterPath}`;
          document.getElementById(`series_poster_preview_${index}`).style.display = 'block';
        } else {
          document.getElementById(`series_poster_preview_${index}`).style.display = 'none';
        }
        
        document.getElementById(`series_search_${index}`).style.display = 'none';
        document.getElementById(`series_results_${index}`).style.display = 'none';
        document.getElementById(`series_selected_${index}`).style.display = 'block';
      }

      function clearMovie(index) {
        document.getElementById(`movie_${index}_tmdb_id`).value = '';
        document.getElementById(`movie_${index}_title`).value = '';
        document.getElementById(`movie_${index}_poster_path`).value = '';
        document.getElementById(`movie_search_${index}`).value = '';
        document.getElementById(`movie_search_${index}`).style.display = 'block';
        document.getElementById(`movie_selected_${index}`).style.display = 'none';
      }

      function clearSeries(index) {
        document.getElementById(`series_${index}_tmdb_id`).value = '';
        document.getElementById(`series_${index}_title`).value = '';
        document.getElementById(`series_${index}_poster_path`).value = '';
        document.getElementById(`series_search_${index}`).value = '';
        document.getElementById(`series_search_${index}`).style.display = 'block';
        document.getElementById(`series_selected_${index}`).style.display = 'none';
      }

      // Cerrar resultados al hacer click fuera
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.movie-search-item')) {
          document.querySelectorAll('[id^="movie_results_"]').forEach(div => div.style.display = 'none');
        }
        if (!e.target.closest('.series-search-item')) {
          document.querySelectorAll('[id^="series_results_"]').forEach(div => div.style.display = 'none');
        }
      });
    </script>

    <hr>

    <h5>Preferencias de B√∫squeda</h5>

    <div class="card card-body" style="margin-bottom: 20px;">
      <div class="field"><b>Buscando: </b>
        <%= select nil, :filter_gender, options_for_select([['Hombre', 'male'], ['Mujer', 'female'], ['Todos', 'gender_any'], ['Pareja', 'couple']], @user.user_filter_preference&.gender_preferences), {}, {class: 'form-control'} %>
      </div>

      <div class="field">
        <b>Hasta km</b>
        <%= text_field nil, :distance_range, value: @user.user_filter_preference&.distance_range, class: 'form-control', placeholder: 'Ej: 50' %>
      </div>
    </div>

    <hr>

    <h5>Intereses Principales <span class="badge badge-info">Obligatorio: 4 intereses</span></h5>

    <% if @edit && @user.user_main_interests.any? %>
      <div style="padding: 10px; margin-bottom: 10px; background-color: #f8f9fa; border-radius: 5px;">
        <strong>Intereses actuales:</strong><br>
        <% @user.user_main_interests.each do |mi| %>
          <span class="badge badge-primary" style="margin: 3px; font-size: 14px; padding: 8px;">
            <%= mi.name %> - <%= mi.percentage %>%
          </span>
        <% end %>
      </div>
    <% end %>

    <div class="card card-body" style="margin-bottom: 20px;">
      <p><small><i>Selecciona exactamente 4 intereses principales. Cada inter√©s tiene un porcentaje de afinidad (0-100%)</i></small></p>
      
      <div id="main-interests-container">
        <% 
          existing_main = @edit ? @user.user_main_interests.to_a : []
          4.times do |i| 
            current_main = existing_main[i]
        %>
          <div class="row" style="margin-bottom: 10px;">
            <div class="col-md-1" style="padding-top: 8px;">
              <strong>#<%= i + 1 %></strong>
            </div>
            <div class="col-md-7">
              <%= select_tag "main_interest_#{i}_id", 
                  options_from_collection_for_select(Interest.all.order(:name), :id, :name, current_main&.interest_id), 
                  { include_blank: "Selecciona un inter√©s", class: 'form-control' } %>
            </div>
            <div class="col-md-4">
              <div class="input-group">
                <%= number_field_tag "main_interest_#{i}_percentage", current_main&.percentage, 
                    { placeholder: "0-100", class: 'form-control', min: 0, max: 100 } %>
                <div class="input-group-append">
                  <span class="input-group-text">%</span>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <hr>

    <h5>Intereses Adicionales</h5>

    <% if @edit %>
      <div style="padding: 10px;">
        <% @user.user_interests.each do |i| %>
          <span class="badge badge-warning" style="margin: 3px;"><%= i.interest.interest_category.name %>: <%= i.interest.name %>

            -- <%= link_to 'Eliminar', i, method: :delete, data: { confirm: '¬øEliminar?' } %>
          </span>
        <% end %>
      </div>
    <% end %>

   <div class="card card-body">

      <div class="field">
         <%= f.label "A√±adir intereses" %>
        <%= collection_select(nil,:user_interests, Interest.where.not(id: @user.user_interests.pluck(:interest_id)), :id, :name, {}, {:multiple => true, class: 'form-control selectpicker', "data-live-search" => "true", style: "height: 300px;"}) %>
      </div>
   </div>

    <hr>

    <h5>üåç Idiomas que habla</h5>
    
    <% 
      # Obtener los idiomas favoritos actuales del usuario (son n√∫meros)
      current_favorite_languages = @edit && @user.favorite_languages.present? ? @user.favorite_languages : []
      
      # Mapeo de n√∫meros a idiomas
      language_options = {
        1 => "Abjasio", 2 => "Afar", 3 => "Afrik√°ans", 4 => "Akan", 5 => "Alban√©s", 
        6 => "Am√°rico", 7 => "√Årabe", 8 => "Aragon√©s", 9 => "Armenio", 10 => "Asam√©s",
        11 => "Avar", 12 => "Av√©stico", 13 => "Aimara", 14 => "Azer√≠", 15 => "Bambara",
        16 => "Baskir", 17 => "Euskera", 18 => "Bielorruso", 19 => "Bengal√≠", 20 => "Bihari",
        21 => "Bislama", 22 => "Bosnio", 23 => "Bret√≥n", 24 => "B√∫lgaro", 25 => "Birmano",
        26 => "Catal√°n", 27 => "Chamorro", 28 => "Checheno", 29 => "Chichewa", 30 => "Chino",
        31 => "Chuvasio", 32 => "C√≥rnico", 33 => "Corso", 34 => "Cree", 35 => "Croata",
        36 => "Checo", 37 => "Dan√©s", 38 => "Maldivo", 39 => "Neerland√©s", 40 => "Dzongkha",
        41 => "Ingl√©s", 42 => "Esperanto", 43 => "Estonio", 44 => "Ew√©", 45 => "Fero√©s",
        46 => "Fiyiano", 47 => "Fin√©s", 48 => "Franc√©s", 49 => "Fula", 50 => "Gallego",
        51 => "Georgiano", 52 => "Alem√°n", 53 => "Griego", 54 => "Guaran√≠", 55 => "Guyarat√≠",
        56 => "Haitiano", 57 => "Hausa", 58 => "Hebreo", 59 => "Herero", 60 => "Hindi",
        61 => "Hiri Motu", 62 => "H√∫ngaro", 63 => "Interlingua", 64 => "Indonesio", 65 => "Interlingue",
        66 => "Irland√©s", 67 => "Igbo", 68 => "Inupiaq", 69 => "Ido", 70 => "Island√©s",
        71 => "Italiano", 72 => "Inuktitut", 73 => "Japon√©s", 74 => "Javan√©s", 75 => "Groenland√©s",
        76 => "Canar√©s", 77 => "Kanuri", 78 => "Cachemir", 79 => "Kazajo", 80 => "Jemer",
        81 => "Kikuyu", 82 => "Kinyarwanda", 83 => "Kirgu√≠s", 84 => "Komi", 85 => "Kongo",
        86 => "Coreano", 87 => "Kurdo", 88 => "Kuanyama", 89 => "Lat√≠n", 90 => "Luxemburgu√©s",
        91 => "Ganda", 92 => "Limburgu√©s", 93 => "Lingala", 94 => "Lao", 95 => "Lituano",
        96 => "Luba-Katanga", 97 => "Let√≥n", 98 => "Man√©s", 99 => "Macedonio", 100 => "Malgache",
        101 => "Malayo", 102 => "Malabar", 103 => "Malt√©s", 104 => "Maor√≠", 105 => "Marat√≠",
        106 => "Marshal√©s", 107 => "Mongol", 108 => "Nauruano", 109 => "Navajo", 110 => "Ndebele del norte",
        111 => "Nepal√≠", 112 => "Ndonga", 113 => "Noruego Bokm√•l", 114 => "Noruego Nynorsk", 115 => "Noruego",
        116 => "Yi de Sichu√°n", 117 => "Ndebele del sur", 118 => "Occitano", 119 => "Ojibwa", 120 => "Eslavo eclesi√°stico",
        121 => "Oromo", 122 => "Oriya", 123 => "Osetio", 124 => "Punyab√≠", 125 => "Pali",
        126 => "Persa", 127 => "Polaco", 128 => "Past√∫n", 129 => "Portugu√©s", 130 => "Quechua",
        131 => "Romanche", 132 => "Kirundi", 133 => "Rumano", 134 => "Ruso", 135 => "S√°nscrito",
        136 => "Sardo", 137 => "Sindhi", 138 => "Sami septentrional", 139 => "Samoano", 140 => "Sango",
        141 => "Serbio", 142 => "Ga√©lico escoc√©s", 143 => "Shona", 144 => "Cingal√©s", 145 => "Eslovaco",
        146 => "Esloveno", 147 => "Somal√≠", 148 => "Sesoto", 149 => "Espa√±ol", 150 => "Sundan√©s",
        151 => "Suajili", 152 => "Suazi", 153 => "Sueco", 154 => "Tamil", 155 => "Telug√∫",
        156 => "Tayiko", 157 => "Tailand√©s", 158 => "Tigri√±a", 159 => "Tibetano", 160 => "Turcomano",
        161 => "Tagalo", 162 => "Tswana", 163 => "Tongano", 164 => "Turco", 165 => "Tsonga",
        166 => "T√°rtaro", 167 => "Twi", 168 => "Tahitiano", 169 => "Uigur", 170 => "Ucraniano",
        171 => "Urdu", 172 => "Uzbeko", 173 => "Venda", 174 => "Vietnamita", 175 => "Volap√ºk",
        176 => "Val√≥n", 177 => "Gal√©s", 178 => "W√≥lof", 179 => "Fris√≥n occidental", 180 => "Xhosa",
        181 => "Yidis", 182 => "Yoruba", 183 => "Zhuang", 184 => "Zul√∫", 185 => "Valenciano"
      }
    %>
    
    <% if @edit && current_favorite_languages.any? %>
      <div style="padding: 10px; margin-bottom: 10px; background-color: #f8f9fa; border-radius: 5px;">
        <strong>Idiomas seleccionados:</strong><br>
        <% current_favorite_languages.each do |lang_id| %>
          <span class="badge badge-info" style="margin: 3px; font-size: 14px; padding: 8px;">
            <%= language_options[lang_id.to_i] || "ID: #{lang_id}" %>
          </span>
        <% end %>
      </div>
    <% end %>

    <div class="card card-body" style="margin-bottom: 20px;">
      <p><small><i>Selecciona los idiomas que el usuario habla. Puedes seleccionar m√∫ltiples idiomas.</i></small></p>
      
      <%= select_tag 'user[favorite_languages][]', 
          options_for_select(language_options.sort_by { |k, v| v }.map { |k, v| [v, k] }, current_favorite_languages.map(&:to_i)),
          { multiple: true, class: 'form-control selectpicker', "data-live-search" => "true", style: "height: 300px;" } %>
      
      <!-- Hidden field para permitir deseleccionar todos los idiomas -->
      <%= hidden_field_tag 'user[favorite_languages][]', '' %>
    </div>

    <hr>

  <div class="field">
    <%= f.label "Contrase√±a" %>   <% if @edit %> <i>(Para mantener la contrase√±a actual mantener en blanco este campo)</i><br /> <% end %>
    <%= f.password_field :password, autocomplete: "new-password", class: 'form-control' %>
    <% if @minimum_password_length %>
      <br />
      <em><%= @minimum_password_length %> caracteres m√≠nimo</em>
    <% end %>
  </div>

  <div class="field">
    <%= f.label "Confirmar contrase√±a" %><br />
    <%= f.password_field :password_confirmation, autocomplete: "new-password", class: 'form-control' %>
  </div>

<!--
  <div class="field">
    <%= f.label "Contrase√±a actual" %> <i>(Necesitamos la contrase√±a actual para confirma tus cambios)</i><br />
    <%= f.password_field :current_password, autocomplete: "current-password", class: 'form-control' %>
  </div>
-->

  <div class="field">
    <p><%= f.check_box :verified, checked: @user.verified %>
    <b>Verificado</b></p>
  </div>




  <div class="field">
    <p><%= f.check_box :admin, checked: @user.admin %>
    <b>Administrador</b></p>
  </div>

  <div class="field">
    <p><%= f.check_box :fake_user, checked: @user.fake_user %>
    <b>Usuario Fake/Bot</b> <i class="fa fa-robot text-info"></i></p>
  </div>


    <div class="field">
    <b>Suscripci√≥n</b>
    <%= f.text_field :current_subscription_name,value: @user.current_subscription_name, class: 'form-control' %>
  </div>


    <div class="field">
    <b>ID suscripci√≥n</b>
    <%= f.text_field :current_subscription_id,value: @user.current_subscription_id, class: 'form-control' %>
  </div>



  <div class="actions">
    <%= button_tag type: 'submit', class: "btn btn-success", style: 'width: 160px; font-size: 12px' do %>
        <i class="fa fa-check" aria-hidden="true"></i> Guardar datos
    <% end %>
  </div>
<% end %>
